<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verify links</title>
    <script>
      async function getAll() {
        let allDataPromise = await fetch("/getAll");

        let allData = await allDataPromise.json();

        document.getElementById("main").innerHTML = "";

        console.log(allData);

        let i = 0;

        allData.forEach((element) => {
          let button = document.createElement("input");
          button.type = "checkbox";
          button.id = element._id;
          button.checked = false;
          button.onclick = async function () {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
              if (this.readyState == 4 && this.status == 200) {
                getAll();
              }
            };
            xhttp.open("POST", "/changeStatus", true);
            xhttp.setRequestHeader(
              "Content-type",
              "application/x-www-form-urlencoded"
            );
            xhttp.send("id=" + element._id + "&approved=" + !element.approved);
          };
          let div = document.createElement("div");
          div.innerHTML = element.siteName;
          div.id = i;
          if (element.approved) {
            div.style.background = "lightgreen";
            button.checked = true;
          } else {
            div.style.background = "red";
          }
          document.getElementById("main").appendChild(div);
          document.getElementById(i).appendChild(button);
          i++;
        });
      }

      function click() {
        window.alert("Test");
      }
    </script>
  </head>
  <body id="main" onload="getAll()"></body>
</html>
